<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>android | Rex的博客</title>
  <meta name="author" content="rex">
  
  <meta name="description" content="[TOC]
WidgetView
###GridView
divider/separator1234567891011horizontalSpacing, verticalSpacing, backgroundColor&amp;lt;GridView        android:id=&#34;@+id/gri">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="android"/>
  <meta property="og:site_name" content="Rex的博客"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Rex的博客" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>

<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">Rex的博客</a><span class="split"></span><span class="title">android</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2018-06-07</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  

  
	<div class="col-md-12">
	  

	  <!-- content -->
	  <p>[TOC]</p>
<h2 id="Widget"><a href="#Widget" class="headerlink" title="Widget"></a>Widget</h2><h3 id="View"><a href="#View" class="headerlink" title="View"></a>View</h3><p><img src="http://ww1.sinaimg.cn/large/9f373d78gy1fsvockegusj20ti11iac3.jpg" alt=""></p>
<p>###GridView</p>
<h4 id="divider-separator"><a href="#divider-separator" class="headerlink" title="divider/separator"></a>divider/separator</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">horizontalSpacing, verticalSpacing, backgroundColor</span><br><span class="line"></span><br><span class="line">&lt;GridView</span><br><span class="line">        android:id=<span class="string">"@+id/gridView1"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:background=<span class="string">"#e5e5e5"</span></span><br><span class="line">        android:horizontalSpacing=<span class="string">"1dp"</span></span><br><span class="line">        android:numColumns=<span class="string">"auto_fit"</span></span><br><span class="line">        android:stretchMode=<span class="string">"columnWidth"</span></span><br><span class="line">        android:verticalSpacing=<span class="string">"1dp"</span> &gt;</span><br></pre></td></tr></table></figure>
<h4 id="items-share-the-height"><a href="#items-share-the-height" class="headerlink" title="items share the height"></a>items share the height</h4><blockquote>
<p> override dispatchDraw</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;getChildCount();i++)&#123;  </span><br><span class="line">    View child=getChildAt(i);  </span><br><span class="line">    ViewGroup.LayoutParams layoutParams=child.getLayoutParams();  </span><br><span class="line">    <span class="comment">//rows表示gridview中子项的行数  </span></span><br><span class="line">    layoutParams.height=getHeight()/rows;</span><br><span class="line">    child.setLayoutParams(layoutParams);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">super</span>.dispatchDraw(canvas);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>override getView</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;  </span><br><span class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;  </span><br><span class="line">                convertView = mInflater.inflate(R.layout.item_home_function, parent, <span class="keyword">false</span>);  </span><br><span class="line">                ViewGroup.LayoutParams layoutParams=convertView.getLayoutParams();  </span><br><span class="line">                layoutParams.height=parent.getHeight()/mRows;</span><br><span class="line">                convertView.setLayoutParams(layoutParams);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">if</span>(convertView.getHeight()==<span class="number">0</span>)&#123;  </span><br><span class="line">                ViewGroup.LayoutParams layoutParams=convertView.getLayoutParams();  </span><br><span class="line">                layoutParams.height=parent.getHeight()/mRows;  </span><br><span class="line">                convertView.setLayoutParams(layoutParams);  </span><br><span class="line">            &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###WebView</p>
<p>####horrible mistake</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NET::ERR_CACHE_MISS</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="back-button-listener"><a href="#back-button-listener" class="headerlink" title="back button listener"></a>back button listener</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; event.getRepeatCount() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// do something on back.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onKeyDown(keyCode, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="common-settings"><a href="#common-settings" class="headerlink" title="common settings"></a>common settings</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">        WebSettings settings = webview.getSettings();</span><br><span class="line">        settings.setJavaScriptEnabled(<span class="keyword">true</span>);</span><br><span class="line">        settings.setSupportZoom(<span class="keyword">true</span>); <span class="comment">// 可以缩放</span></span><br><span class="line">        settings.setUseWideViewPort(<span class="keyword">true</span>);  <span class="comment">//为图片添加放大缩小功能</span></span><br><span class="line">        settings.setDomStorageEnabled(<span class="keyword">true</span>);</span><br><span class="line">        mWebview.setLayerType(View.LAYER_TYPE_SOFTWARE, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">mWebview.setWebViewClient(<span class="keyword">new</span> WebViewClient()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//返回值是true的时候控制去WebView打开，为false调用系统浏览器或第三方浏览器</span></span><br><span class="line">                view.loadUrl(url);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//是否在webview内加载页面</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, WebResourceRequest request)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">                    view.loadUrl(request.getUrl().toString());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    view.loadUrl(request.toString());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mWebview.setWebChromeClient(<span class="keyword">new</span> WebChromeClient() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsAlert</span><span class="params">(WebView view, String url, String message, JsResult result)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onJsAlert(view, url, message, result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mWebview.addJavascriptInterface(<span class="keyword">new</span> WebAppInterface(<span class="keyword">this</span>),<span class="string">"myInterfaceName"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String  postData = <span class="string">"username="</span> + URLEncoder.encode(name, <span class="string">"UTF-8"</span>)+ </span><br><span class="line">    <span class="string">"&amp;password="</span> + URLEncoder.encode(pwd, <span class="string">"UTF-8"</span>);</span><br><span class="line">            mWebview.postUrl(url,postData.getBytes());</span><br></pre></td></tr></table></figure>
<h4 id="html-input-radiobutton"><a href="#html-input-radiobutton" class="headerlink" title="html input radiobutton"></a>html input radiobutton</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">7.0</span>系统滑动下一页点击按钮之后,选中状态没有更新,而稍微滑动一下就更新了</span><br><span class="line">webView.setLayerType(View.LAYER_TYPE_SOFTWARE, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">android:hardwareAccelerated=<span class="string">"false"</span></span><br></pre></td></tr></table></figure>
<p>####html dom</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">使用HTML5 DOM存储，不会主动加载到Android WebView中。</span><br><span class="line">webView.getSetting()..setDomStorageEnabled(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">具体分析详见 https:<span class="comment">//eyalvardi.wordpress.com/2014/01/20/android-and-angularjs/</span></span><br></pre></td></tr></table></figure>
<h4 id="play-video"><a href="#play-video" class="headerlink" title="play video"></a>play video</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// webView.setLayerType(View.LAYER_TYPE_SOFTWARE, null);</span><br><span class="line">android:hardwareAccelerated=&quot;true&quot;</span><br></pre></td></tr></table></figure>
<h4 id="memory-leak"><a href="#memory-leak" class="headerlink" title="memory leak"></a>memory leak</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">1</span>.不在xml中定义 Webview ，而是在需要的时候在Activity中创建，并且Context使用 getApplicationgContext()</span><br><span class="line">LinearLayout.LayoutParams params = <span class="keyword">new</span> LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);</span><br><span class="line">        mWebView = <span class="keyword">new</span> WebView(getApplicationContext());</span><br><span class="line">        mWebView.setLayoutParams(params);</span><br><span class="line">        mLayout.addView(mWebView);</span><br><span class="line"><span class="number">2</span>.在 Activity 销毁（ WebView ）的时候，先让 WebView 加载<span class="keyword">null</span>内容，然后移除 WebView，再销毁 WebView，最后置空。</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mWebView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mWebView.loadDataWithBaseURL(<span class="keyword">null</span>, <span class="string">""</span>, <span class="string">"text/html"</span>, <span class="string">"utf-8"</span>, <span class="keyword">null</span>);</span><br><span class="line">            mWebView.clearHistory();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//在关闭了Activity时，如果Webview的音乐或视频，还在播放。就必须销毁Webview</span></span><br><span class="line">            <span class="comment">//但是注意：webview调用destory时,webview仍绑定在Activity上</span></span><br><span class="line">            <span class="comment">//这是由于自定义webview构建时传入了该Activity的context对象</span></span><br><span class="line">            <span class="comment">//因此需要先从父容器中移除webview,然后再销毁webview:</span></span><br><span class="line">            ((ViewGroup) mWebView.getParent()).removeView(mWebView);</span><br><span class="line">            mWebView.destroy();</span><br><span class="line">            mWebView = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>####back/forward</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Webview.canGoBack() </span><br><span class="line">Webview.goBack()</span><br><span class="line"></span><br><span class="line">Webview.canGoForward()</span><br><span class="line">Webview.goForward()</span><br><span class="line"></span><br><span class="line"><span class="comment">//以当前的index为起始点前进或者后退到历史记录中指定的steps</span></span><br><span class="line"><span class="comment">//如果steps为负数则为后退，正数则为前进</span></span><br><span class="line">Webview.goBackOrForward(intsteps)</span><br></pre></td></tr></table></figure>
<p>####clear</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//清除网页访问留下的缓存</span></span><br><span class="line"><span class="comment">//由于内核缓存是全局的因此这个方法不仅仅针对webview而是针对整个应用程序.</span></span><br><span class="line">Webview.clearCache(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//清除当前webview访问的历史记录</span></span><br><span class="line"><span class="comment">//只会webview访问历史记录里的所有记录除了当前访问记录</span></span><br><span class="line">Webview.clearHistory()；</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个api仅仅清除自动完成填充的表单数据，并不会清除WebView存储到本地的数据</span></span><br><span class="line">Webview.clearFormData()；</span><br></pre></td></tr></table></figure>
<h4 id="settings"><a href="#settings" class="headerlink" title="settings"></a>settings</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置自适应屏幕，两者合用</span></span><br><span class="line">webSettings.setUseWideViewPort(<span class="keyword">true</span>); <span class="comment">//将图片调整到适合webview的大小 </span></span><br><span class="line">webSettings.setLoadWithOverviewMode(<span class="keyword">true</span>); <span class="comment">// 缩放至屏幕的大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//缩放操作</span></span><br><span class="line">webSettings.setSupportZoom(<span class="keyword">true</span>); <span class="comment">//支持缩放，默认为true。是下面那个的前提。</span></span><br><span class="line">webSettings.setBuiltInZoomControls(<span class="keyword">true</span>); <span class="comment">//设置内置的缩放控件。若为false，则该WebView不可缩放</span></span><br><span class="line">webSettings.setDisplayZoomControls(<span class="keyword">false</span>); <span class="comment">//隐藏原生的缩放控件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//其他</span></span><br><span class="line"><span class="comment">//LOAD_CACHE_ONLY: 不使用网络，只读取本地缓存数据</span></span><br><span class="line">        <span class="comment">//LOAD_DEFAULT: （默认）根据cache-control决定是否从网络上取数据。</span></span><br><span class="line">        <span class="comment">//LOAD_NO_CACHE: 不使用缓存，只从网络获取数据.</span></span><br><span class="line">        <span class="comment">//LOAD_CACHE_ELSE_NETWORK，只要本地有，无论是否过期，或者no-cache，都使用缓存中的数据。</span></span><br><span class="line">webSettings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK); <span class="comment">//关闭webview中缓存 </span></span><br><span class="line">webSettings.setAllowFileAccess(<span class="keyword">true</span>); <span class="comment">//设置可以访问文件 </span></span><br><span class="line">webSettings.setJavaScriptCanOpenWindowsAutomatically(<span class="keyword">true</span>); <span class="comment">//支持通过JS打开新窗口 </span></span><br><span class="line">webSettings.setLoadsImagesAutomatically(<span class="keyword">true</span>); <span class="comment">//支持自动加载图片</span></span><br><span class="line">webSettings.setDefaultTextEncodingName(<span class="string">"utf-8"</span>);<span class="comment">//设置编码格式</span></span><br><span class="line"></span><br><span class="line">webSettings.setDomStorageEnabled(<span class="keyword">true</span>); <span class="comment">// 开启 DOM storage API 功能</span></span><br><span class="line">webSettings.setDatabaseEnabled(<span class="keyword">true</span>);   <span class="comment">//开启 database storage API 功能</span></span><br><span class="line">webSettings.setAppCacheEnabled(<span class="keyword">true</span>);<span class="comment">//开启 Application Caches 功能</span></span><br><span class="line"></span><br><span class="line">String cacheDirPath = getFilesDir().getAbsolutePath() + APP_CACAHE_DIRNAME;</span><br><span class="line">webSettings.setAppCachePath(cacheDirPath); <span class="comment">//设置  Application Caches 缓存目录</span></span><br></pre></td></tr></table></figure>
<h4 id="webviewclient"><a href="#webviewclient" class="headerlink" title="webviewclient"></a>webviewclient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">复写shouldOverrideUrlLoading()方法，使得打开网页时不调用系统浏览器， 而是在本WebView中显示</span><br><span class="line">    webView.setWebViewClient(<span class="keyword">new</span> WebViewClient()&#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</span><br><span class="line">          view.loadUrl(url);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// onPageStarted</span></span><br><span class="line">      <span class="comment">// onPageFinished</span></span><br><span class="line">      <span class="comment">// onLoadResource 在加载页面资源时会调用，每一个资源（比如图片）的加载都会调用一次</span></span><br><span class="line">      <span class="comment">// onReceivedError 不能连接服务器</span></span><br><span class="line">      <span class="comment">// onReceivedHttpError 400等</span></span><br><span class="line">      <span class="comment">// onReceivedSslError 处理https请求</span></span><br><span class="line">      </span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="webchromeclient"><a href="#webchromeclient" class="headerlink" title="webchromeclient"></a>webchromeclient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onProgressChanged 加载网页的进度</span></span><br><span class="line"><span class="comment">// onReceivedTitle 得到网页title</span></span><br></pre></td></tr></table></figure>
<h4 id="adapter-pad"><a href="#adapter-pad" class="headerlink" title="adapter pad"></a>adapter pad</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">DisplayMetrics metrics = <span class="keyword">new</span> DisplayMetrics();</span><br><span class="line">getWindowManager().getDefaultDisplay().getMetrics(metrics);</span><br><span class="line"><span class="keyword">int</span> mDensity = metrics.densityDpi;</span><br><span class="line"><span class="keyword">if</span> (mDensity == <span class="number">240</span>) &#123;</span><br><span class="line">    webSettings.setDefaultZoom(WebSettings.ZoomDensity.FAR);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mDensity == <span class="number">160</span>) &#123;</span><br><span class="line">    webSettings.setDefaultZoom(WebSettings.ZoomDensity.MEDIUM);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mDensity == <span class="number">120</span>) &#123;</span><br><span class="line">    webSettings.setDefaultZoom(WebSettings.ZoomDensity.CLOSE);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mDensity == DisplayMetrics.DENSITY_XHIGH) &#123;</span><br><span class="line">    webSettings.setDefaultZoom(WebSettings.ZoomDensity.FAR);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mDensity == DisplayMetrics.DENSITY_TV) &#123;</span><br><span class="line">    webSettings.setDefaultZoom(WebSettings.ZoomDensity.FAR);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    webSettings.setDefaultZoom(WebSettings.ZoomDensity.MEDIUM);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用WebView显示图片，可使用这个参数 设置网页布局类型：</span></span><br><span class="line"><span class="comment"> * 1、LayoutAlgorithm.NARROW_COLUMNS ：适应内容大小</span></span><br><span class="line"><span class="comment"> * 2、LayoutAlgorithm.SINGLE_COLUMN:适应屏幕，内容将自动缩放</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">webSettings.setLayoutAlgorithm(WebSettings.LayoutAlgorithm.NARROW_COLUMNS);</span><br></pre></td></tr></table></figure>
<h4 id="call-js"><a href="#call-js" class="headerlink" title="call js"></a>call js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// evaluateJavascript 有返回值</span><br><span class="line">// loadUrl 无返回值</span><br></pre></td></tr></table></figure>
<h4 id="download-file"><a href="#download-file" class="headerlink" title="download file"></a>download file</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">webView.setDownloadListener(<span class="keyword">new</span> DownloadListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDownloadStart</span><span class="params">(String url, String userAgent, String contentDisposition, String mimetype, <span class="keyword">long</span> contentLength)</span> </span>&#123;</span><br><span class="line">                downloadByBrowser(url);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">downloadByBrowser</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class="line">        intent.addCategory(Intent.CATEGORY_BROWSABLE);</span><br><span class="line">        intent.setData(Uri.parse(url));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h4><p><a href="https://www.jianshu.com/p/3a345d27cd42" target="_blank" rel="noopener">漏洞</a></p>
<h2 id="TextView"><a href="#TextView" class="headerlink" title="TextView"></a>TextView</h2><h4 id="bold"><a href="#bold" class="headerlink" title="bold"></a>bold</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">testTextView=(TextView) findViewById(R.id.testTextView);</span><br><span class="line">testTextView.getPaint().setFakeBoldText(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">英文和数字可以直接用XML去设置:</span><br><span class="line">android:textStyle=<span class="string">"bold"</span></span><br></pre></td></tr></table></figure>
<p>##EditText</p>
<h4 id="drawable-click"><a href="#drawable-click" class="headerlink" title="drawable click"></a>drawable click</h4><h6 id="no-reinventing"><a href="#no-reinventing" class="headerlink" title="no reinventing"></a>no reinventing</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">editComment.setOnTouchListener(<span class="keyword">new</span> OnTouchListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> DRAWABLE_LEFT = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> DRAWABLE_TOP = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> DRAWABLE_RIGHT = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> DRAWABLE_BOTTOM = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(event.getAction() == MotionEvent.ACTION_UP) &#123;</span><br><span class="line">                <span class="comment">// event.getRawX() or event.getX()</span></span><br><span class="line">                <span class="keyword">if</span>(event.getX() &gt;= (editComment.getWidth() - editComment.getCompoundDrawables()[DRAWABLE_RIGHT].getBounds().width())) &#123;</span><br><span class="line">                    <span class="comment">// your action here</span></span><br><span class="line"></span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h6 id="or-another-way"><a href="#or-another-way" class="headerlink" title="or another way"></a>or another way</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomEditText</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">support</span>.<span class="title">v7</span>.<span class="title">widget</span>.<span class="title">AppCompatEditText</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Drawable drawableRight;</span><br><span class="line">    <span class="keyword">private</span> Drawable drawableLeft;</span><br><span class="line">    <span class="keyword">private</span> Drawable drawableTop;</span><br><span class="line">    <span class="keyword">private</span> Drawable drawableBottom;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> actionX, actionY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DrawableClickListener clickListener;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomEditText</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        <span class="comment">// this Contructure required when you are using this view in xml</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomEditText</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSizeChanged</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> oldw, <span class="keyword">int</span> oldh)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onSizeChanged(w, h, oldw, oldh);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCompoundDrawables</span><span class="params">(Drawable left, Drawable top,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Drawable right, Drawable bottom)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (left != <span class="keyword">null</span>) &#123;</span><br><span class="line">            drawableLeft = left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            drawableRight = right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (top != <span class="keyword">null</span>) &#123;</span><br><span class="line">            drawableTop = top;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bottom != <span class="keyword">null</span>) &#123;</span><br><span class="line">            drawableBottom = bottom;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.setCompoundDrawables(left, top, right, bottom);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        Rect bounds;</span><br><span class="line">        <span class="keyword">if</span> (event.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            actionX = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">            actionY = (<span class="keyword">int</span>) event.getY();</span><br><span class="line">            <span class="keyword">if</span> (drawableBottom != <span class="keyword">null</span></span><br><span class="line">                    &amp;&amp; drawableBottom.getBounds().contains(actionX, actionY)) &#123;</span><br><span class="line">                clickListener.onClick(DrawableClickListener.DrawablePosition.BOTTOM);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (drawableTop != <span class="keyword">null</span></span><br><span class="line">                    &amp;&amp; drawableTop.getBounds().contains(actionX, actionY)) &#123;</span><br><span class="line">                clickListener.onClick(DrawableClickListener.DrawablePosition.TOP);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// this works for left since container shares 0,0 origin with bounds</span></span><br><span class="line">            <span class="keyword">if</span> (drawableLeft != <span class="keyword">null</span>) &#123;</span><br><span class="line">                bounds = <span class="keyword">null</span>;</span><br><span class="line">                bounds = drawableLeft.getBounds();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> x, y;</span><br><span class="line">                <span class="keyword">int</span> extraTapArea = (<span class="keyword">int</span>) (<span class="number">13</span> * getResources().getDisplayMetrics().density + <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">                x = actionX;</span><br><span class="line">                y = actionY;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!bounds.contains(actionX, actionY)) &#123;</span><br><span class="line">                    <span class="comment">/** Gives the +20 area for tapping. */</span></span><br><span class="line">                    x = (<span class="keyword">int</span>) (actionX - extraTapArea);</span><br><span class="line">                    y = (<span class="keyword">int</span>) (actionY - extraTapArea);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (x &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        x = actionX;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (y &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        y = actionY;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">/** Creates square from the smallest value */</span></span><br><span class="line">                    <span class="keyword">if</span> (x &lt; y) &#123;</span><br><span class="line">                        y = x;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (bounds.contains(x, y) &amp;&amp; clickListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    clickListener</span><br><span class="line">                            .onClick(DrawableClickListener.DrawablePosition.LEFT);</span><br><span class="line">                    event.setAction(MotionEvent.ACTION_CANCEL);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (drawableRight != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">                bounds = <span class="keyword">null</span>;</span><br><span class="line">                bounds = drawableRight.getBounds();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> x, y;</span><br><span class="line">                <span class="keyword">int</span> extraTapArea = <span class="number">13</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * IF USER CLICKS JUST OUT SIDE THE RECTANGLE OF THE DRAWABLE</span></span><br><span class="line"><span class="comment">                 * THAN ADD X AND SUBTRACT THE Y WITH SOME VALUE SO THAT AFTER</span></span><br><span class="line"><span class="comment">                 * CALCULATING X AND Y CO-ORDINATE LIES INTO THE DRAWBABLE</span></span><br><span class="line"><span class="comment">                 * BOUND. - this process help to increase the tappable area of</span></span><br><span class="line"><span class="comment">                 * the rectangle.</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                x = (<span class="keyword">int</span>) (actionX + extraTapArea);</span><br><span class="line">                y = (<span class="keyword">int</span>) (actionY - extraTapArea);</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**Since this is right drawable subtract the value of x from the width</span></span><br><span class="line"><span class="comment">                 * of view. so that width - tappedarea will result in x co-ordinate in drawable bound.</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                x = getWidth() - x;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/*x can be negative if user taps at x co-ordinate just near the width.</span></span><br><span class="line"><span class="comment">                 * e.g views width = 300 and user taps 290. Then as per previous calculation</span></span><br><span class="line"><span class="comment">                 * 290 + 13 = 303. So subtract X from getWidth() will result in negative value.</span></span><br><span class="line"><span class="comment">                 * So to avoid this add the value previous added when x goes negative.</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (x &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    x += extraTapArea;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* If result after calculating for extra tappable area is negative.</span></span><br><span class="line"><span class="comment">                 * assign the original value so that after subtracting</span></span><br><span class="line"><span class="comment">                 * extratapping area value doesn't go into negative value.</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (y &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    y = actionY;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**If drawble bounds contains the x and y points then move ahead.*/</span></span><br><span class="line">                <span class="keyword">if</span> (bounds.contains(x, y) &amp;&amp; clickListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    clickListener</span><br><span class="line">                            .onClick(DrawableClickListener.DrawablePosition.RIGHT);</span><br><span class="line">                    event.setAction(MotionEvent.ACTION_CANCEL);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        drawableRight = <span class="keyword">null</span>;</span><br><span class="line">        drawableBottom = <span class="keyword">null</span>;</span><br><span class="line">        drawableLeft = <span class="keyword">null</span>;</span><br><span class="line">        drawableTop = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">super</span>.finalize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDrawableClickListener</span><span class="params">(DrawableClickListener listener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.clickListener = listener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="class"><span class="keyword">interface</span> <span class="title">DrawableClickListener</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> DrawablePosition &#123;TOP, BOTTOM, LEFT, RIGHT&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DrawablePosition target)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="hide-display-drawable"><a href="#hide-display-drawable" class="headerlink" title="hide/display drawable"></a>hide/display drawable</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">editText.setCompoundDrawablesWithIntrinsicBounds(<span class="number">0</span>, <span class="number">0</span>, isValidate?<span class="number">0</span>:R.drawable.warning, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="ScrollView"><a href="#ScrollView" class="headerlink" title="ScrollView"></a>ScrollView</h2><h4 id="scroll-to-bottom"><a href="#scroll-to-bottom" class="headerlink" title="scroll to bottom"></a>scroll to bottom</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mhScrollView.postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                                mhScrollView.fullScroll(ScrollView.FOCUS_DOWN);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,<span class="number">300</span>);</span><br></pre></td></tr></table></figure>
<h4 id="set-max-height"><a href="#set-max-height" class="headerlink" title="set max height"></a>set max height</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">    heightMeasureSpec = MeasureSpec.makeMeasureSpec(maxHeight, MeasureSpec.AT_MOST);</span><br><span class="line">    <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h1><h4 id="open-file"><a href="#open-file" class="headerlink" title="open file"></a>open file</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">version &gt; <span class="number">24</span> , you must add temp right</span><br><span class="line">Intent.FLAG_GRANT_READ_URI_PERMISSION</span><br></pre></td></tr></table></figure>
<h4 id="Install-apk"><a href="#Install-apk" class="headerlink" title="Install apk"></a>Install apk</h4><blockquote>
<p>Android Manifest.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_EXTERNAL_STORAGE"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Android 8.1 需要这个--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.REQUEST_INSTALL_PACKAGES"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:name</span>=<span class="string">"android.support.v4.content.FileProvider"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:authorities</span>=<span class="string">"你的包名.fileProvider"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:grantUriPermissions</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:exported</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">               <span class="attr">android:name</span>=<span class="string">"android.support.FILE_PROVIDER_PATHS"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">android:resource</span>=<span class="string">"@xml/file_paths"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>res/xml/file_paths.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">paths</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-path</span> <span class="attr">path</span>=<span class="string">"Android/data/你app的包名/"</span> <span class="attr">name</span>=<span class="string">"files_root"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-path</span> <span class="attr">path</span>=<span class="string">"."</span> <span class="attr">name</span>=<span class="string">"external_storage_root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>version &gt; Android M 需要动态申请权限</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Storage Permissions</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_EXTERNAL_STORAGE = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String[] PERMISSIONS_STORAGE = &#123;</span><br><span class="line">            Manifest.permission.READ_EXTERNAL_STORAGE,</span><br><span class="line">            Manifest.permission.WRITE_EXTERNAL_STORAGE</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> permission = ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE);</span><br><span class="line">        <span class="keyword">if</span> (permission != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            <span class="comment">// We don't have permission so prompt the user</span></span><br><span class="line">            ActivityCompat.requestPermissions(</span><br><span class="line">                    <span class="keyword">this</span>,</span><br><span class="line">                    PERMISSIONS_STORAGE,</span><br><span class="line">                    REQUEST_EXTERNAL_STORAGE</span><br><span class="line">            );</span><br></pre></td></tr></table></figure>
<blockquote>
<p>调用系统安装</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class="line">                intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">                intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</span><br><span class="line"></span><br><span class="line">File file = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory(), apkName);</span><br><span class="line">Uri uri = Uri.fromFile(file);</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">24</span>) &#123;</span><br><span class="line">            uri = FileProvider.getUriForFile(context, BuildConfig.APPLICATION_ID + <span class="string">".fileProvider"</span>, file);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">                intent.setDataAndType(uri,</span><br><span class="line">                        <span class="string">"application/vnd.android.package-archive"</span>);</span><br><span class="line">                startActivity(intent);</span><br></pre></td></tr></table></figure>
<h2 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h2><h4 id="Bad-window-token-you-cannot-show-a-dialog-before-an-Activity-is-created-or-after-it’s-hidden"><a href="#Bad-window-token-you-cannot-show-a-dialog-before-an-Activity-is-created-or-after-it’s-hidden" class="headerlink" title="Bad window token, you cannot show a dialog before an Activity is created or after it’s hidden."></a>Bad window token, you cannot show a dialog before an Activity is created or after it’s hidden.</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pass the Activity instance here, not the application context.</span><br></pre></td></tr></table></figure>
<h1 id="Dialog"><a href="#Dialog" class="headerlink" title="Dialog"></a>Dialog</h1><h4 id="java-lang-IllegalArgumentException-View-not-attached-to-window-manager"><a href="#java-lang-IllegalArgumentException-View-not-attached-to-window-manager" class="headerlink" title="java.lang.IllegalArgumentException: View not attached to window manager"></a>java.lang.IllegalArgumentException: View not attached to window manager</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.使用Activity自带的回调，比如onCreateDialog(),showDialog(),dimissDialog(),removeDialog()</span><br><span class="line"><span class="number">2</span>.在onDestroy关闭dialog</span><br></pre></td></tr></table></figure>
<p>#Thread</p>
<h4 id="thread-pool"><a href="#thread-pool" class="headerlink" title="thread pool"></a>thread pool</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">excuteThread</span><span class="params">(Runnable runnable)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//org.apache.commons.lang3.concurrent.BasicThreadFactory</span></span><br><span class="line">        ThreadFactory namedThreadFactory = <span class="keyword">new</span> BasicThreadFactory.Builder().namingPattern(<span class="string">"project-schedule-pool-%d"</span>).build();</span><br><span class="line">        <span class="comment">//Common Thread Pool</span></span><br><span class="line">        ExecutorService pool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">200</span>,</span><br><span class="line">                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">1024</span>), namedThreadFactory, <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class="line">        pool.execute(runnable);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h1><h4 id="More-than-one-file-was-found-with-OS-independent-path-‘META-INF-DEPENDENCIES’"><a href="#More-than-one-file-was-found-with-OS-independent-path-‘META-INF-DEPENDENCIES’" class="headerlink" title="More than one file was found with OS independent path ‘META-INF/DEPENDENCIES’"></a>More than one file was found with OS independent path ‘META-INF/DEPENDENCIES’</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">工程生成了不止一个META-INF/DEPENDENCIES文件，</span><br><span class="line">因为多个 jar 包里包含了同样的文件（DEPENDENCIES.txt），导致打包时因为担心相互覆盖问题而提示出错</span><br><span class="line">在报该编译错误的module的build.gradle中加入:</span><br><span class="line">    </span><br><span class="line">packagingOptions &#123;</span><br><span class="line">        exclude <span class="string">'META-INF/DEPENDENCIES'</span></span><br><span class="line">        exclude <span class="string">'META-INF/NOTICE'</span></span><br><span class="line">        exclude <span class="string">'META-INF/LICENSE'</span></span><br><span class="line">        exclude <span class="string">'META-INF/LICENSE.txt'</span></span><br><span class="line">        exclude <span class="string">'META-INF/NOTICE.txt'</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="Sign"><a href="#Sign" class="headerlink" title="Sign"></a>Sign</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jarsigner -verbose -keystore appKey.keystore app.apk keyAlias</span><br><span class="line">jarsigner -verify signed.apk </span><br><span class="line">jarsigner -certs -verbose -verify signed.apk</span><br></pre></td></tr></table></figure>
<h2 id="Android-Source-Code"><a href="#Android-Source-Code" class="headerlink" title="Android Source Code"></a>Android Source Code</h2><h3 id="Online"><a href="#Online" class="headerlink" title="Online"></a>Online</h3><p><a href="https://www.androidos.net.cn" target="_blank" rel="noopener">https://www.androidos.net.cn</a></p>
<p><a href="http://androidxref.com/" target="_blank" rel="noopener">http://androidxref.com/</a></p>
<h3 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/</span><br><span class="line"></span><br><span class="line">mkdir ~/bin</span><br><span class="line">PATH=~/bin:$PATH</span><br><span class="line">curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo</span><br><span class="line">chmod a+x ~/bin/repo</span><br><span class="line"></span><br><span class="line">wget -c https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly/aosp-latest.tar # 下载初始化包</span><br><span class="line">tar xf aosp-latest.tar</span><br><span class="line">cd AOSP   # 解压得到的 AOSP 工程目录</span><br><span class="line"># 这时 ls 的话什么也看不到，因为只有一个隐藏的 .repo 目录</span><br><span class="line">repo sync # 正常同步一遍即可得到完整目录</span><br><span class="line"># 或 repo sync -l 仅checkout代码</span><br></pre></td></tr></table></figure>
<h1 id="LOG"><a href="#LOG" class="headerlink" title="LOG"></a>LOG</h1><h4 id="common-log-command"><a href="#common-log-command" class="headerlink" title="common log command"></a>common log command</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adb logcat -b crash</span><br><span class="line">adb logcat AndroidRuntime:E *:S</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">After ANR happens, you would find call stack of related process at /data/anr/traces.txt </span><br><span class="line">After application crashes, you might find call stack of crashed application under /data/tombstones directory.</span><br><span class="line"></span><br><span class="line">实时打印的主要有：logcat main，logcat radio，logcat events，tcpdump，还有高通平台的还会有QXDM日志</span><br></pre></td></tr></table></figure>
<h4 id="HorizontalScrollView-SavedState-cannot-be-cast-to-android-widget-ScrollView-SavedState"><a href="#HorizontalScrollView-SavedState-cannot-be-cast-to-android-widget-ScrollView-SavedState" class="headerlink" title="HorizontalScrollView$SavedState cannot be cast to android.widget.ScrollView$SavedState"></a>HorizontalScrollView$SavedState cannot be cast to android.widget.ScrollView$SavedState</h4><p><a href="https://blog.51cto.com/lbrant/1670280" target="_blank" rel="noopener">View onRestoreInstanceState ClassCastException</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">D/AndroidRuntime: Shutting down VM</span><br><span class="line">W/System.err: java.lang.ClassCastException: android.widget.HorizontalScrollView$SavedState cannot be cast to android.widget.ScrollView$SavedState</span><br><span class="line">        at android.widget.ScrollView.onRestoreInstanceState(ScrollView.java:<span class="number">1807</span>)</span><br><span class="line">        at android.view.View.dispatchRestoreInstanceState(View.java:<span class="number">14789</span>)</span><br><span class="line">        at android.view.ViewGroup.dispatchRestoreInstanceState(ViewGroup.java:<span class="number">3124</span>)</span><br><span class="line">        at android.view.ViewGroup.dispatchRestoreInstanceState(ViewGroup.java:<span class="number">3130</span>)</span><br><span class="line">        at android.view.ViewGroup.dispatchRestoreInstanceState(ViewGroup.java:<span class="number">3130</span>)</span><br><span class="line">        at android.view.ViewGroup.dispatchRestoreInstanceState(ViewGroup.java:<span class="number">3130</span>)</span><br><span class="line">        at android.view.View.restoreHierarchyState(View.java:<span class="number">14767</span>)</span><br><span class="line">        at androidx.fragment.app.Fragment.restoreViewState(Fragment.java:<span class="number">510</span>)</span><br><span class="line">        at androidx.fragment.app.FragmentManagerImpl.moveToState(FragmentManagerImpl.java:<span class="number">913</span>)</span><br><span class="line">        at androidx.fragment.app.FragmentManagerImpl.moveFragmentToExpectedState(FragmentManagerImpl.java:<span class="number">1233</span>)</span><br><span class="line">        at androidx.fragment.app.FragmentManagerImpl.moveToState(FragmentManagerImpl.java:<span class="number">1299</span>)</span><br><span class="line">        at androidx.fragment.app.BackStackRecord.executeOps(BackStackRecord.java:<span class="number">688</span>)</span><br><span class="line">W/System.err:     at androidx.fragment.app.FragmentManagerImpl.executeOps(FragmentManagerImpl.java:<span class="number">2069</span>)</span><br><span class="line">        at androidx.fragment.app.FragmentManagerImpl.executeOpsTogether(FragmentManagerImpl.java:<span class="number">1859</span>)</span><br><span class="line">        at androidx.fragment.app.FragmentManagerImpl.removeRedundantOperationsAndExecute(FragmentManagerImpl.java:<span class="number">1814</span>)</span><br><span class="line">        at androidx.fragment.app.FragmentManagerImpl.execPendingActions(FragmentManagerImpl.java:<span class="number">1721</span>)</span><br><span class="line">        at androidx.fragment.app.FragmentManagerImpl$<span class="number">1</span>.run(FragmentManagerImpl.java:<span class="number">147</span>)</span><br><span class="line">        at android.os.Handler.handleCallback(Handler.java:<span class="number">742</span>)</span><br><span class="line">        at android.os.Handler.dispatchMessage(Handler.java:<span class="number">95</span>)</span><br><span class="line">        at android.os.Looper.loop(Looper.java:<span class="number">157</span>)</span><br><span class="line">        at android.app.ActivityThread.main(ActivityThread.java:<span class="number">5603</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">        at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">774</span>)</span><br><span class="line">        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">652</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span><span class="params">(Parcelable state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mContext.getApplicationInfo().targetSdkVersion &lt;= Build.VERSION_CODES.JELLY_BEAN_MR2) &#123;</span><br><span class="line">            <span class="comment">// Some old apps reused IDs in ways they shouldn't have.</span></span><br><span class="line">            <span class="comment">// Don't break them, but they don't get scroll state restoration.</span></span><br><span class="line">            <span class="keyword">super</span>.onRestoreInstanceState(state);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SavedState ss = (SavedState) state;</span><br><span class="line">        <span class="keyword">super</span>.onRestoreInstanceState(ss.getSuperState());</span><br><span class="line">        mSavedState = ss;</span><br><span class="line">        requestLayout();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>大概意思就是在Android API 18（4.2.2和4.4.2之间的一个版本）以前，不会保存ScrollView的滚动条位置，这个对我影响也不是很大，规避这个问题我能想到有如下两种：</p>
<ol>
<li><p>将AndroidMainifest.xml中android:targetSdkVersion降为18以下（如果需要记录这个状态，可以在onSaveInstanceState中记录位置，onRestoreInstanceState中恢复就可以了）；</p>
</li>
<li><p>不让View保存状态：</p>
<p>android:saveEnabled=”false”|setSaveEnabled(false)|不要给view设置id</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Called by &#123;<span class="doctag">@link</span> #saveHierarchyState(android.util.SparseArray)&#125; to store the state for</span></span><br><span class="line"><span class="comment"> * this view and its children. May be overridden to modify how freezing happens to a</span></span><br><span class="line"><span class="comment"> * view's children; for example, some views may want to not store state for their children.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> container The SparseArray in which to save the view's state.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #dispatchRestoreInstanceState(android.util.SparseArray)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #saveHierarchyState(android.util.SparseArray)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #onSaveInstanceState()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">dispatchSaveInstanceState</span><span class="params">(SparseArray&lt;Parcelable&gt; container)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mID != NO_ID &amp;&amp; (mViewFlags &amp; SAVE_DISABLED_MASK) == <span class="number">0</span>) &#123;</span><br><span class="line">        mPrivateFlags &amp;= ~PFLAG_SAVE_STATE_CALLED;</span><br><span class="line">        Parcelable state = onSaveInstanceState();</span><br><span class="line">        <span class="keyword">if</span> ((mPrivateFlags &amp; PFLAG_SAVE_STATE_CALLED) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                    <span class="string">"Derived class did not call super.onSaveInstanceState()"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (state != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Log.i("View", "Freezing #" + Integer.toHexString(mID)</span></span><br><span class="line">            <span class="comment">// + ": " + state);</span></span><br><span class="line">            container.put(mID, state);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="key-keystore"><a href="#key-keystore" class="headerlink" title="key.keystore"></a>key.keystore</h1><h4 id="common-command"><a href="#common-command" class="headerlink" title="common command"></a>common command</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -v -keystore debug.keystore</span><br><span class="line">1.查看签名信息： keytool -list -v -keystore 文件名</span><br><span class="line"></span><br><span class="line">2.修改密码：keytool -storepasswd -keystore 文件名</span><br><span class="line">执行后会提示输入证书的当前密码，和新密码以及重复新密码 确认。</span><br><span class="line"></span><br><span class="line">3.修改别名：keytool -changealias -keystore my.keystore 文件名 -alias 别名 -destalias 新别名</span><br></pre></td></tr></table></figure>
<h4 id="keytool-error-java-security-UnrecoverableKeyException-Cannot-recover-key"><a href="#keytool-error-java-security-UnrecoverableKeyException-Cannot-recover-key" class="headerlink" title="keytool error: java.security.UnrecoverableKeyException: Cannot recover key"></a>keytool error: java.security.UnrecoverableKeyException: Cannot recover key</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -keystore server.jks -storePass 123456 -alias server -keypass 123456</span><br><span class="line"></span><br><span class="line">生成keystore的时候，分别有: 别名密码和keystore的密码,它们不一定一致</span><br><span class="line">keytool -genkey -keystore server.jks -storePass 123456 -alias server -keypass 123456</span><br></pre></td></tr></table></figure>
<h1 id="Android-support-library"><a href="#Android-support-library" class="headerlink" title="Android support library"></a>Android support library</h1><p><a href="https://developer.android.com/jetpack/androidx/migrate" target="_blank" rel="noopener">Androidx</a></p>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
			
		
	
		
			
			
			
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
	
	
		<li class="prev"><a href="/2018/06/11/oracle-sql/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/2018/06/07/photo-shop/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  &copy; 2019 rex
  
      with help from <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-wixo/">Wixo</a>.    
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




</body>
</html>
